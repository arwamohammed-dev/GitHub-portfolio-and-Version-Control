<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Radar Map</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <style>
        #map {
            width: 100%;
            height: 100vh;
        }
    </style>
</head>
<body>

    <div id="map"></div>

    <script>
    var map = L.map('map').setView([24.7136, 46.6753], 6);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18
    }).addTo(map);

    var planeIcon = L.icon({
        iconUrl: "/static/plane.png",
        iconSize: [40, 40],
        iconAnchor: [20, 20]
    });

    var planes = {};

    function updatePlanes() {
        fetch("/planes")
            .then(res => res.json())
            .then(data => {
                for (let id in data) {
                    let p = data[id];

                    if (!planes[id]) {
                        planes[id] = L.marker([p.lat, p.lon], {
                            icon: planeIcon,
                            rotationAngle: p.heading
                        }).addTo(map);
                    } else {
                        planes[id].setLatLng([p.lat, p.lon]);
                        planes[id].setRotationAngle(p.heading);
                    }
                }
            });
    }

    setInterval(updatePlanes, 1000);
    </script>

</body>
</html>

